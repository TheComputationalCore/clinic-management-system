<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Doctor Dashboard - Clinic Management System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: linear-gradient(135deg, #6f42c1, #0d6efd);
            min-height: 100vh;
            padding: 50px 0;
            font-family: 'Segoe UI', sans-serif;
        }

        .dashboard-card {
            background: white;
            border-radius: 18px;
            padding: 35px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }

        .section-title {
            font-weight: 600;
            margin-bottom: 20px;
        }

        .table th {
            font-weight: 600;
        }

        .btn {
            border-radius: 8px;
        }

        .badge-status {
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 12px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="dashboard-card">

        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h3>üë®‚Äç‚öïÔ∏è Doctor Dashboard</h3>
                <p class="text-muted mb-0">
                    Welcome Dr.
                    <span th:text="${doctor != null and doctor.user != null ? doctor.user.email : 'Doctor'}"></span>
                </p>
            </div>

            <form th:action="@{/logout}" method="post">
                <input type="hidden"
                       th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}" />
                <button class="btn btn-outline-danger">
                    Logout
                </button>
            </form>
        </div>

        <!-- ======================= -->
        <!-- Pending Appointments -->
        <!-- ======================= -->

        <h5 class="section-title">Pending Appointments</h5>

        <div class="table-responsive mb-5"
             th:if="${pendingAppointments != null and !#lists.isEmpty(pendingAppointments)}">

            <table class="table align-middle">
                <thead class="table-light">
                <tr>
                    <th>Patient</th>
                    <th>Time</th>
                    <th>Status</th>
                    <th class="text-center">Actions</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="appointment : ${pendingAppointments}">
                    <td th:text="${appointment.patient.name}"></td>

                    <td th:text="${#temporals.format(appointment.appointmentTime, 'yyyy-MM-dd HH:mm')}"></td>

                    <td>
                        <span class="badge bg-warning badge-status"
                              th:text="${appointment.status}">
                        </span>
                    </td>

                    <td class="text-center">

                        <form th:action="@{/doctor/appointments/{id}/approve(id=${appointment.id})}"
                              method="post"
                              class="d-inline">
                            <input type="hidden"
                                   th:name="${_csrf.parameterName}"
                                   th:value="${_csrf.token}" />
                            <button class="btn btn-sm btn-success">
                                Approve
                            </button>
                        </form>

                        <form th:action="@{/doctor/appointments/{id}/reject(id=${appointment.id})}"
                              method="post"
                              class="d-inline ms-2">
                            <input type="hidden"
                                   th:name="${_csrf.parameterName}"
                                   th:value="${_csrf.token}" />
                            <button class="btn btn-sm btn-danger">
                                Reject
                            </button>
                        </form>

                    </td>
                </tr>
                </tbody>
            </table>

        </div>

        <div th:if="${pendingAppointments == null or #lists.isEmpty(pendingAppointments)}"
             class="text-muted mb-5">
            No pending appointments.
        </div>

        <!-- ======================= -->
        <!-- All Appointments -->
        <!-- ======================= -->

        <h5 class="section-title">All Appointments</h5>

        <div class="table-responsive"
             th:if="${appointments != null and !#lists.isEmpty(appointments)}">

            <table class="table align-middle">
                <thead class="table-light">
                <tr>
                    <th>Patient</th>
                    <th>Time</th>
                    <th>Status</th>
                    <th>Patient Profile</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="appointment : ${appointments}">
                    <td th:text="${appointment.patient.name}"></td>

                    <td th:text="${#temporals.format(appointment.appointmentTime, 'yyyy-MM-dd HH:mm')}"></td>

                    <td>
                        <span th:text="${appointment.status}"
                              th:classappend="
                                ${appointment.status.name() == 'APPROVED'} ? 'badge bg-success' :
                                (${appointment.status.name() == 'REJECTED'} ? 'badge bg-danger' :
                                (${appointment.status.name() == 'COMPLETED'} ? 'badge bg-primary' :
                                'badge bg-secondary'))">
                        </span>
                    </td>

                    <td>
                        <a th:href="@{/doctor/patient/{id}(id=${appointment.patient.id})}"
                           class="btn btn-sm btn-outline-primary">
                            View Patient
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>

        </div>

        <div th:if="${appointments == null or #lists.isEmpty(appointments)}"
             class="text-muted">
            No appointments found.
        </div>

    </div>
</div>

</body>
</html>
